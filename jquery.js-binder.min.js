/**
 * jsBinder 2.0.0
 * @author https://github.com/moafred
 * @homepage https://github.com/moafred/jsBinder
 */
(function(e){var t=new Array;var n=null;e.jsBinder=function(r){function o(e,r){if(v(e,"func"))window[v(e,"func")](e);var s=true;if(i.executeBehavior==="safe"){if(n!==null){if(i.debug)console.log("-- Reject new request.");s=false}}if(i.executeBehavior==="force"){if(n!==null){if(i.debug)console.log("-- Abord current request and start new one.");n.abort()}}if(i.executeBehavior==="sync"){if(n!==null){if(i.debug)console.log("-- Adding new request in queue : "+e+".");t.push({element:e,functionName:r});s=false}}if(i.executeBehavior==="async"){}if(s===true)if(i.debug)console.log("<br/>");return s}function u(){n=null;if(i.executeBehavior==="sync"&&t.length>0){t.shift();if(t.length>0){if(t[0].functionName==="call")l(t[0].element);else if(t[0].functionName==="callForm")callForm(t[0].element)}}}function a(t){l(e("*["+i.jbKey+'-refresh="'+t+'"]'))}function f(t){e(t.attr(i.jbKey+"-toggle")).toggle()}function l(t){if(!o(t,"call"))return;var n=v(t,"link");var r=v(t,"method")?v(t,"method"):"get";var s=v(t,"format")?v(t,"format"):null;if(s===null)s=i.defaultCallbackFormat==="html"?null:i.defaultCallbackFormat;if(i.debug)console.log('Call "'+n+'" with method "'+r+'" and callbackFormat: '+s+".");h(e.ajax({url:n,type:r,datatype:s}),t)}function c(t){if(!o(t,"formCall"))return;var n=v(t,"form").length>0?t.parents("form"):e('form[name="'+v(t,"form")+'"]');var r=v(t,"link")?v(t,"link"):n.attr("action");var s=v(t,"method")?v(t,"method"):n.attr("method");var u=v(t,"format")?v(t,"format"):null;if(u===null)u=i.defaultCallbackFormat==="html"?null:i.defaultCallbackFormat;var a=n.serialize();a+="&"+n.attr("name");if(i.disableFormInputs){var f=n.find("input, select, textarea");f.attr("disabled","disabled")}if(i.debug)console.log('Form call "'+r+'" with method "'+s+'", callbackFormat: '+u+", parameter(s): "+a);h(e.ajax({url:r,type:s,datatype:u,data:a}),t)}function h(e,t){n=e;n.done(function(e,n,r){p(t,e,n,r)});n.fail(function(e,n,r){d(t,e,n,r)});n.always(function(){u();if(i.disableFormInputs){var e=t.parents("form");if(e){var n=e.find("input, select, textarea");n.removeAttr("disabled")}}})}function p(t,n,r,s){if(i.debug)console.log("["+s.status+"] Request done.");var o=v(t,"wrapper");if(o){if(i.debug)console.log("Load response content in: "+o+".");e(o).html(n)}var u=v(t,"callback");if(u){if(i.debug)console.log("Callback custom function: "+u+".");window[u](t,n,r,s,null)}if(u&&!o){if(i.debug)console.log("End (without specified behavior).")}}function d(e,t,n,r){if(r==="abort")return;if(i.debug)console.log("["+t.status+"] Request error: "+n+" - "+r);var s=v(e,"callback");if(s){if(i.debug)console.log('Callback custom function: "'+s+'".');var o=null;window[s](e,o,n,t,r)}}function v(e,t){return e.attr(i.jbKey+"-"+t)}var i=e.extend({debug:false,executeBehavior:"safe",jqueryEvents:new Array("click","mouseover"),defaultCallbackFormat:"json",disableFormInputs:true,jbKey:"jb"},r);if(i.debug){console.log("---- jsBinder ----");console.log('Config: ExecuteType["'+i.executeBehavior+'"]');console.log("Registred events: "+i.jqueryEvents)}jQuery(document).on("click","*["+i.jbKey+"-link]:not(["+i.jbKey+"-event]), ["+i.jbKey+"-refresh]:not(["+i.jbKey+"-event])",function(t){l(e(this));t.preventDefault()});jQuery(document).on("click","*["+i.jbKey+"-func]:not(["+i.jbKey+"-event]):not(["+i.jbKey+"-link]):not(["+i.jbKey+"-form])",function(t){window[v(e(this),"func")](e(this));t.preventDefault()});for(var s=0;s<i.jqueryEvents.length;s++){e("*["+i.jbKey+"-link]["+i.jbKey+'-event="'+i.jqueryEvents[s]+'"], *['+i.jbKey+"-refresh]["+i.jbKey+'-event="'+i.jqueryEvents[s]+'"]').bind(i.jqueryEvents[s],function(t){l(e(this));t.preventDefault()});e("*["+i.jbKey+"-toggle]["+i.jbKey+'-event="'+i.jqueryEvents[s]+'"]').bind(i.jqueryEvents[s],function(t){f(e(this));t.preventDefault()});e("*["+i.jbKey+"-func]["+i.jbKey+'-event="'+i.jqueryEvents[s]+'"]:not(['+i.jbKey+"-link]):not(["+i.jbKey+"-form])").bind(i.jqueryEvents[s],function(t){window[v(e(this),"func")](e(this));t.preventDefault()})}jQuery(document).on("click","*["+i.jbKey+"-form]",function(t){c(e(this));t.preventDefault()});return this}})(jQuery)